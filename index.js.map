{"mappings":"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","sources":["src/index.ts","src/utils/helpers.ts","src/constants.ts","src/types.ts","src/utils/property_getters.ts","src/utils/json_getters.ts","src/utils/tcd.ts"],"sourcesContent":["#!/usr/bin/env node\r\nimport { createResultLog, removeNonLetterCharacters } from \"./utils/helpers\";\r\nimport { exec } from \"child_process\";\r\nimport { PartsBranchName } from \"./types\";\r\nimport { PROPERTY_MAP } from \"./constants\";\r\nimport { tcd } from \"./utils/tcd\";\r\nimport { getBranchNameTemplate, getIsAutoCheckout } from \"./utils/json_getters\";\r\n\r\nconst getBranchNameByTemplate = tcd(async () => {\r\n  const branchNameTemplate = getBranchNameTemplate();\r\n  const properties = branchNameTemplate.match(/<\\w*>/gi) ?? [];\r\n\r\n  let result = branchNameTemplate;\r\n\r\n  for await (const property of properties) {\r\n    const propertyName = removeNonLetterCharacters(property);\r\n    const propertyValue = await PROPERTY_MAP[propertyName as PartsBranchName]();\r\n    const regExp = propertyValue\r\n      ? new RegExp(property, \"gi\")\r\n      : new RegExp(`${property}?\\\\W`, \"gi\");\r\n    result = result.replace(regExp, propertyValue || \"\");\r\n  }\r\n\r\n  return result;\r\n});\r\n\r\nconst main = async () => {\r\n  const branchNameByTemplate = await getBranchNameByTemplate();\r\n  const isAutoCheckout = getIsAutoCheckout();\r\n  const gitCommand = isAutoCheckout ? \"git checkout -b\" : \"git branch\";\r\n\r\n  const fullCommand = `${gitCommand} ${branchNameByTemplate}`;\r\n\r\n  exec(fullCommand, createResultLog(fullCommand));\r\n};\r\n\r\nmain();\r\n","import { ExecException } from \"child_process\";\r\n\r\nconst transformToAnswers = (data: string[]) =>\r\n  data.map((answer) => ({\r\n    value: answer,\r\n  }));\r\n\r\nconst removeNonLetterCharacters = (str: string) => str.replace(/\\W/gi, \"\");\r\n\r\nconst createResultLog =\r\n  (command: string) =>\r\n  // @ts-ignore\r\n  (error: ExecException | null, stdout: string, stderr: string) => {\r\n    if (error) {\r\n      console.log(`error: ${error.message}`);\r\n      return;\r\n    }\r\n    if (stderr) {\r\n      console.log(`stderr: ${stderr}`);\r\n      return;\r\n    }\r\n    console.log(command);\r\n  };\r\n\r\nexport { transformToAnswers, removeNonLetterCharacters, createResultLog };\r\n","import { PartsBranchName } from \"./types\";\r\nimport {\r\n  getTaskType,\r\n  getProjectName,\r\n  getTaskName,\r\n  getTaskNumber,\r\n} from \"./utils/property_getters\";\r\n\r\nconst CONFIG_FILE_NAME = \"cbconfig.json\";\r\n\r\nconst DEFAULT_TASK_NAME_DELIMITER = \"_\";\r\nconst DEFAULT_BRANCH_NAME_TEMPLATE =\r\n  \"<task_type>/<project_name>-<task_id>-<task_name>\";\r\nconst DEFAULT_IS_AUTO_CHECKOUT = false;\r\n\r\nconst PROPERTY_MAP: Record<PartsBranchName, () => any> = {\r\n  [PartsBranchName.task_type]: getTaskType,\r\n  [PartsBranchName.project_name]: getProjectName,\r\n  [PartsBranchName.task_id]: getTaskNumber,\r\n  [PartsBranchName.task_name]: getTaskName,\r\n};\r\n\r\nexport {\r\n  DEFAULT_IS_AUTO_CHECKOUT,\r\n  DEFAULT_TASK_NAME_DELIMITER,\r\n  DEFAULT_BRANCH_NAME_TEMPLATE,\r\n  PROPERTY_MAP,\r\n  CONFIG_FILE_NAME,\r\n};\r\n","export interface Config {\r\n  project_names: string | string[];\r\n  task_types: string | string[];\r\n  branch_name_template: string;\r\n  task_name_delimiter?: string;\r\n  auto_checkout?: boolean;\r\n}\r\n\r\nexport enum PartsBranchName {\r\n  project_name = \"project_name\",\r\n  task_type = \"task_type\",\r\n  task_id = \"task_id\",\r\n  task_name = \"task_name\",\r\n}\r\n","import {\r\n  getTaskTypes,\r\n  getProjectNames,\r\n  getTaskNameDelimiter,\r\n} from \"./json_getters\";\r\nimport inquirer from \"inquirer\";\r\nimport { tcd } from \"./tcd\";\r\nimport { transformToAnswers } from \"./helpers\";\r\n\r\nconst getTaskType = tcd(async () => {\r\n  const taskTypes = getTaskTypes();\r\n  if (taskTypes.length === 1) return taskTypes[0];\r\n\r\n  const answers = transformToAnswers(taskTypes);\r\n  const question = {\r\n    message: \"Select task type\",\r\n    name: \"task_type\",\r\n    type: \"list\",\r\n    choices: answers,\r\n  };\r\n\r\n  const answer = await inquirer.prompt([question]);\r\n\r\n  return answer[question.name];\r\n});\r\n\r\nconst getProjectName = tcd(async () => {\r\n  const questionName = \"project_name\";\r\n  const projectNames = getProjectNames();\r\n  if (projectNames.length === 1) return projectNames[0];\r\n\r\n  const answers = transformToAnswers(projectNames);\r\n  const question = {\r\n    message: \"Select project name\",\r\n    name: questionName,\r\n    type: \"list\",\r\n    choices: answers,\r\n  };\r\n\r\n  const answer = await inquirer.prompt([question]);\r\n\r\n  return answer[questionName];\r\n});\r\n\r\nconst getTaskNumber = tcd(async () => {\r\n  const question = {\r\n    message: \"Type task id\",\r\n    name: \"task_id\",\r\n    type: \"number\",\r\n  };\r\n\r\n  const answer = await inquirer.prompt([question]);\r\n\r\n  return answer[question.name];\r\n});\r\n\r\nconst getTaskName = tcd(async () => {\r\n  const question = {\r\n    message: \"Type task name\",\r\n    name: \"task_name\",\r\n    type: \"input\",\r\n  };\r\n\r\n  const answer = await inquirer.prompt([question]);\r\n  const delimiter = getTaskNameDelimiter();\r\n\r\n  return answer[question.name].trim().replace(/\\W/gi, delimiter);\r\n});\r\n\r\nexport { getTaskType, getTaskName, getTaskNumber, getProjectName };\r\n","import { Config } from \"../types\";\r\nimport {\r\n  CONFIG_FILE_NAME,\r\n  DEFAULT_BRANCH_NAME_TEMPLATE,\r\n  DEFAULT_IS_AUTO_CHECKOUT,\r\n  DEFAULT_TASK_NAME_DELIMITER,\r\n} from \"../constants\";\r\nimport { findUpSync } from \"find-up\";\r\nimport fs from \"fs\";\r\nimport { tcd } from \"./tcd\";\r\n\r\nconst readConfig = () => {\r\n  let config: Config | null = null;\r\n\r\n  const resolve = tcd(() => {\r\n    const pkg = findUpSync(CONFIG_FILE_NAME, { cwd: process.cwd() });\r\n    config = JSON.parse(fs.readFileSync(pkg as string, \"utf8\"));\r\n    return config;\r\n  });\r\n\r\n  return () => config ?? resolve();\r\n};\r\n\r\nconst getConfig = readConfig();\r\n\r\nconst getProperty = <T extends keyof Config>(name: T): Config[T] => {\r\n  const config = getConfig();\r\n  if (!config) throw new Error(`You need to create file cbconfig.json`);\r\n  if (config[name] == null) throw new Error(`You need to add ${name} property`);\r\n  return config[name];\r\n};\r\n\r\nconst getTaskTypes = (): string[] => {\r\n  const result = getProperty(\"task_types\");\r\n  return Array.isArray(result) ? result : [result];\r\n};\r\n\r\nconst getProjectNames = (): string[] => {\r\n  const result = getProperty(\"project_names\");\r\n  return Array.isArray(result) ? result : [result];\r\n};\r\n\r\nconst getTaskNameDelimiter = (): string =>\r\n  getProperty(\"task_name_delimiter\") ?? DEFAULT_TASK_NAME_DELIMITER;\r\n\r\nconst getBranchNameTemplate = (): string =>\r\n  getProperty(\"branch_name_template\") ?? DEFAULT_BRANCH_NAME_TEMPLATE;\r\n\r\nconst getIsAutoCheckout = (): boolean =>\r\n  getProperty(\"auto_checkout\") ?? DEFAULT_IS_AUTO_CHECKOUT;\r\n\r\nexport {\r\n  getProperty,\r\n  getIsAutoCheckout,\r\n  getBranchNameTemplate,\r\n  getTaskTypes,\r\n  getProjectNames,\r\n  getTaskNameDelimiter,\r\n};\r\n","const tryCatchDecorator =\n  (fn: Function, onRejected: (err: unknown) => any) =>\n  (...args: any[]) => {\n    try {\n      return fn(...args);\n    } catch (err) {\n      return onRejected(err);\n    }\n  };\n\nconst defaultTryCatchDecorator = (fn: Function) =>\n  tryCatchDecorator(fn, (err) => {\n    console.error(err);\n  });\n\nexport const tcd = defaultTryCatchDecorator;\n"],"names":[],"version":3,"file":"index.js.map"}